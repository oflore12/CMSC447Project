{% extends 'base.html' %}

{% block title %}Filter Search{% endblock %}
{% block content %}
<div class="flex-shrink-0 p-1" style="width: 250px;">
  <button class="btn btn-toggle align-items-center" type="button" data-bs-toggle="collapse" href="#filterOptions" aria-expanded="false">Filter Your Seach!</button>
  <div class="collapse " id="filterOptions">
    <ul class="list-unstyled">

      <li>
        <button class="btn btn-toggle d-inline-flex align-items-center border-0" data-bs-toggle="collapse" data-bs-target="#genre-collapse">Genre</button>
        <div class="collapse" id="genre-collapse">
          <p id="genreList"></p>
        </div>
      </li>


      <li>
        <button class="btn btn-toggle d-inline-flex align-items-center border-0" data-bs-toggle="collapse" data-bs-target="#paying-Option-collapse" aria-expanded="false">Paying Option</button>
        <div class="collapse" id="paying-Option-collapse">
          <p id="payingList"></p>
        </div>
      </li>


      <li>
        <button class="btn btn d-inline-flex align-items-center border-0">Watch Region</button>
        <p id="countryList"></p>
      </li>


      <li>
        <button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-toggle="collapse" data-bs-target="#year-collapse" aria-expanded="false">Release Year</button>
        <div class="collapse" id="year-collapse">
          <div class="d-flex ps-1 border-0">

            <p style="font-size:80%;">1900</p>
            <input type="range" min="1900" max="2023" value="2023" class="form-range" id="yearFilter" onClick="getYear()">
            <p style="font-size:80%;">2023</p>

          </div>
          <p style="font-size:80%; ps-1">Year Selected: <span id="yearValue"></span></p>
        </div>
      </li>


      <li>
        <button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-toggle="collapse" data-bs-target="#rating-collapse" aria-expanded="false">Ratings</button>
        <div class="collapse" id="rating-collapse">
          <div class="d-inline-flex align-content-center">

            <p style="font-size:80%;">1</p>
            <input type="range" class="form-range" min="1" max="10" step="1" value="" id="rateFilter" onClick="getRating()">
            <p style="font-size:80%;">10</p>

          </div>

        </div>
      </li>

      <li>
        <button type="button" class="btn btn-success btn-sm mx-auto" style="width: 200px" id="search" onClick="enableSearch()">Search</button>
      </li>
    </ul>
  </div>
</div>


<div class="d-flex flex-wrap align-content-auto p-3" id="results">
</div>

<div class="mx-auto" style= "width: 200px;">
<button type="button" class="btn btn-warning align-self-center" id="resetBtn" onClick="window.location.reload()">Restart Search</button>
</div>

<script>
var genreFilter = "";
var payingFilter = "";
var countryFilter = "";
var yearFilter = "";
var ratingFilter = "";
var searchType = "";
const base_URL = 'https://api.themoviedb.org/3/discover/movie?api_key=523e00cfc7fcc6bed883c38162ea974d&language=en-US&sort_by=popularity.desc&include_adult=false&include_video=false&page=1';
const IMG_URL = 'https://image.tmdb.org/t/p/w500';

const button1 = document.getElementById("search");
button1.disabled = true;

//genre option filter
const genres = [{"id":28,"name":"Action"},{"id":12,"name":"Adventure"},{"id":16,"name":"Animation"},{"id":35,"name":"Comedy"},{"id":80,"name":"Crime"},{"id":99,"name":"Documentary"},{"id":18,"name":"Drama"},{"id":10751,"name":"Family"},{"id":14,"name":"Fantasy"},{"id":36,"name":"History"},{"id":27,"name":"Horror"},{"id":10402,"name":"Music"},{"id":9648,"name":"Mystery"},{"id":10749,"name":"Romance"},{"id":878,"name":"Science Fiction"},{"id":10770,"name":"TV Movie"},{"id":53,"name":"Thriller"},{"id":10752,"name":"War"},{"id":37,"name":"Western"}];
let genreslist = `<select class="form-select-sm border-0" id="genreSelected" onChange="getGenre()">`;
genreslist += `<option value="All_G" selected>All Genres</option>`;
for (const x of genres) {
  genreslist += `<option value="${x.id}">${x.name}</option>`;
}
genreslist += `</select>`;
document.getElementById("genreList").innerHTML = genreslist;

//paying option filter
const payOptions = [{ "id": "flatrate","name": "Flatrate"}, {"id": "free", "name": "Free"}, {"id": "ads", "name": "Ads"}, {"id": "rent","name": "Rent"}, {"id": "buy","name": "Buy"}];

let payList = `<select class="form-select-sm border-0" id="paySelected" onChange="getPayingOption()">`;
payList += `<option value="All_PO" selected>All Paying Options</option>`;
for (const x of payOptions) {
  payList += `<option value="${x.id}">${x.name}</option>`;
}
payList += `</select>`;
document.getElementById("payingList").innerHTML = payList;

//Country/Region Filter
const listOfCountries = [{"iso_3166_1":"AD","english_name":"Andorra","native_name":"Andorra"},{"iso_3166_1":"AE","english_name":"United Arab Emirates","native_name":"United Arab Emirates"},{"iso_3166_1":"AG","english_name":"Antigua and Barbuda","native_name":"Antigua & Barbuda"},{"iso_3166_1":"AL","english_name":"Albania","native_name":"Albania"},{"iso_3166_1":"AR","english_name":"Argentina","native_name":"Argentina"},{"iso_3166_1":"AT","english_name":"Austria","native_name":"Austria"},{"iso_3166_1":"AU","english_name":"Australia","native_name":"Australia"},{"iso_3166_1":"BA","english_name":"Bosnia and Herzegovina","native_name":"Bosnia & Herzegovina"},{"iso_3166_1":"BB","english_name":"Barbados","native_name":"Barbados"},{"iso_3166_1":"BE","english_name":"Belgium","native_name":"Belgium"},{"iso_3166_1":"BG","english_name":"Bulgaria","native_name":"Bulgaria"},{"iso_3166_1":"BH","english_name":"Bahrain","native_name":"Bahrain"},{"iso_3166_1":"BM","english_name":"Bermuda","native_name":"Bermuda"},{"iso_3166_1":"BO","english_name":"Bolivia","native_name":"Bolivia"},{"iso_3166_1":"BR","english_name":"Brazil","native_name":"Brazil"},{"iso_3166_1":"BS","english_name":"Bahamas","native_name":"Bahamas"},{"iso_3166_1":"CA","english_name":"Canada","native_name":"Canada"},{"iso_3166_1":"CH","english_name":"Switzerland","native_name":"Switzerland"},{"iso_3166_1":"CI","english_name":"Cote D'Ivoire","native_name":"Côte d’Ivoire"},{"iso_3166_1":"CL","english_name":"Chile","native_name":"Chile"},{"iso_3166_1":"CO","english_name":"Colombia","native_name":"Colombia"},{"iso_3166_1":"CR","english_name":"Costa Rica","native_name":"Costa Rica"},{"iso_3166_1":"CU","english_name":"Cuba","native_name":"Cuba"},{"iso_3166_1":"CV","english_name":"Cape Verde","native_name":"Cape Verde"},{"iso_3166_1":"CZ","english_name":"Czech Republic","native_name":"Czech Republic"},{"iso_3166_1":"DE","english_name":"Germany","native_name":"Germany"},{"iso_3166_1":"DK","english_name":"Denmark","native_name":"Denmark"},{"iso_3166_1":"DO","english_name":"Dominican Republic","native_name":"Dominican Republic"},{"iso_3166_1":"DZ","english_name":"Algeria","native_name":"Algeria"},{"iso_3166_1":"EC","english_name":"Ecuador","native_name":"Ecuador"},{"iso_3166_1":"EE","english_name":"Estonia","native_name":"Estonia"},{"iso_3166_1":"EG","english_name":"Egypt","native_name":"Egypt"},{"iso_3166_1":"ES","english_name":"Spain","native_name":"Spain"},{"iso_3166_1":"FI","english_name":"Finland","native_name":"Finland"},{"iso_3166_1":"FJ","english_name":"Fiji","native_name":"Fiji"},{"iso_3166_1":"FR","english_name":"France","native_name":"France"},{"iso_3166_1":"GB","english_name":"United Kingdom","native_name":"United Kingdom"},{"iso_3166_1":"GF","english_name":"French Guiana","native_name":"French Guiana"},{"iso_3166_1":"GH","english_name":"Ghana","native_name":"Ghana"},{"iso_3166_1":"GI","english_name":"Gibraltar","native_name":"Gibraltar"},{"iso_3166_1":"GP","english_name":"Guadaloupe","native_name":"Guadeloupe"},{"iso_3166_1":"GQ","english_name":"Equatorial Guinea","native_name":"Equatorial Guinea"},{"iso_3166_1":"GR","english_name":"Greece","native_name":"Greece"},{"iso_3166_1":"GT","english_name":"Guatemala","native_name":"Guatemala"},{"iso_3166_1":"HK","english_name":"Hong Kong","native_name":"Hong Kong SAR China"},{"iso_3166_1":"HN","english_name":"Honduras","native_name":"Honduras"},{"iso_3166_1":"HR","english_name":"Croatia","native_name":"Croatia"},{"iso_3166_1":"HU","english_name":"Hungary","native_name":"Hungary"},{"iso_3166_1":"ID","english_name":"Indonesia","native_name":"Indonesia"},{"iso_3166_1":"IE","english_name":"Ireland","native_name":"Ireland"},{"iso_3166_1":"IL","english_name":"Israel","native_name":"Israel"},{"iso_3166_1":"IN","english_name":"India","native_name":"India"},{"iso_3166_1":"IQ","english_name":"Iraq","native_name":"Iraq"},{"iso_3166_1":"IS","english_name":"Iceland","native_name":"Iceland"},{"iso_3166_1":"IT","english_name":"Italy","native_name":"Italy"},{"iso_3166_1":"JM","english_name":"Jamaica","native_name":"Jamaica"},{"iso_3166_1":"JO","english_name":"Jordan","native_name":"Jordan"},{"iso_3166_1":"JP","english_name":"Japan","native_name":"Japan"},{"iso_3166_1":"KE","english_name":"Kenya","native_name":"Kenya"},{"iso_3166_1":"KR","english_name":"South Korea","native_name":"South Korea"},{"iso_3166_1":"KW","english_name":"Kuwait","native_name":"Kuwait"},{"iso_3166_1":"LB","english_name":"Lebanon","native_name":"Lebanon"},{"iso_3166_1":"LC","english_name":"St. Lucia","native_name":"St. Lucia"},{"iso_3166_1":"LI","english_name":"Liechtenstein","native_name":"Liechtenstein"},{"iso_3166_1":"LT","english_name":"Lithuania","native_name":"Lithuania"},{"iso_3166_1":"LV","english_name":"Latvia","native_name":"Latvia"},{"iso_3166_1":"LY","english_name":"Libyan Arab Jamahiriya","native_name":"Libya"},{"iso_3166_1":"MA","english_name":"Morocco","native_name":"Morocco"},{"iso_3166_1":"MC","english_name":"Monaco","native_name":"Monaco"},{"iso_3166_1":"MD","english_name":"Moldova","native_name":"Moldova"},{"iso_3166_1":"MK","english_name":"Macedonia","native_name":"Macedonia"},{"iso_3166_1":"MT","english_name":"Malta","native_name":"Malta"},{"iso_3166_1":"MU","english_name":"Mauritius","native_name":"Mauritius"},{"iso_3166_1":"MX","english_name":"Mexico","native_name":"Mexico"},{"iso_3166_1":"MY","english_name":"Malaysia","native_name":"Malaysia"},{"iso_3166_1":"MZ","english_name":"Mozambique","native_name":"Mozambique"},{"iso_3166_1":"NE","english_name":"Niger","native_name":"Niger"},{"iso_3166_1":"NG","english_name":"Nigeria","native_name":"Nigeria"},{"iso_3166_1":"NL","english_name":"Netherlands","native_name":"Netherlands"},{"iso_3166_1":"NO","english_name":"Norway","native_name":"Norway"},{"iso_3166_1":"NZ","english_name":"New Zealand","native_name":"New Zealand"},{"iso_3166_1":"OM","english_name":"Oman","native_name":"Oman"},{"iso_3166_1":"PA","english_name":"Panama","native_name":"Panama"},{"iso_3166_1":"PE","english_name":"Peru","native_name":"Peru"},{"iso_3166_1":"PF","english_name":"French Polynesia","native_name":"French Polynesia"},{"iso_3166_1":"PH","english_name":"Philippines","native_name":"Philippines"},{"iso_3166_1":"PK","english_name":"Pakistan","native_name":"Pakistan"},{"iso_3166_1":"PL","english_name":"Poland","native_name":"Poland"},{"iso_3166_1":"PS","english_name":"Palestinian Territory","native_name":"Palestinian Territories"},{"iso_3166_1":"PT","english_name":"Portugal","native_name":"Portugal"},{"iso_3166_1":"PY","english_name":"Paraguay","native_name":"Paraguay"},{"iso_3166_1":"QA","english_name":"Qatar","native_name":"Qatar"},{"iso_3166_1":"RO","english_name":"Romania","native_name":"Romania"},{"iso_3166_1":"RS","english_name":"Serbia","native_name":"Serbia"},{"iso_3166_1":"RU","english_name":"Russia","native_name":"Russia"},{"iso_3166_1":"SA","english_name":"Saudi Arabia","native_name":"Saudi Arabia"},{"iso_3166_1":"SC","english_name":"Seychelles","native_name":"Seychelles"},{"iso_3166_1":"SE","english_name":"Sweden","native_name":"Sweden"},{"iso_3166_1":"SG","english_name":"Singapore","native_name":"Singapore"},{"iso_3166_1":"SI","english_name":"Slovenia","native_name":"Slovenia"},{"iso_3166_1":"SK","english_name":"Slovakia","native_name":"Slovakia"},{"iso_3166_1":"SM","english_name":"San Marino","native_name":"San Marino"},{"iso_3166_1":"SN","english_name":"Senegal","native_name":"Senegal"},{"iso_3166_1":"SV","english_name":"El Salvador","native_name":"El Salvador"},{"iso_3166_1":"TC","english_name":"Turks and Caicos Islands","native_name":"Turks & Caicos Islands"},{"iso_3166_1":"TH","english_name":"Thailand","native_name":"Thailand"},{"iso_3166_1":"TN","english_name":"Tunisia","native_name":"Tunisia"},{"iso_3166_1":"TR","english_name":"Turkey","native_name":"Turkey"},{"iso_3166_1":"TT","english_name":"Trinidad and Tobago","native_name":"Trinidad & Tobago"},{"iso_3166_1":"TW","english_name":"Taiwan","native_name":"Taiwan"},{"iso_3166_1":"TZ","english_name":"Tanzania","native_name":"Tanzania"},{"iso_3166_1":"UG","english_name":"Uganda","native_name":"Uganda"},{"iso_3166_1":"US","english_name":"United States of America","native_name":"United States"},{"iso_3166_1":"UY","english_name":"Uruguay","native_name":"Uruguay"},{"iso_3166_1":"VA","english_name":"Holy See","native_name":"Vatican City"},{"iso_3166_1":"VE","english_name":"Venezuela","native_name":"Venezuela"},{"iso_3166_1":"XK","english_name":"Kosovo","native_name":"Kosovo"},{"iso_3166_1":"YE","english_name":"Yemen","native_name":"Yemen"},{"iso_3166_1":"ZA","english_name":"South Africa","native_name":"South Africa"},{"iso_3166_1":"ZM","english_name":"Zambia","native_name":"Zambia"}];

let countrylist = `<select class="form-select-sm border-0" id="countrySelected" onChange="getCountry()">`;
countrylist += `<option value="US" selected>United States of America</option>`;
countrylist += `<option value="All_C">All Countries</option>`;
for (const x of listOfCountries) {
  countrylist += `<option value="${x.iso_3166_1}">${x.english_name}</option>`;
}
countrylist += `</select>`;
document.getElementById("countryList").innerHTML = countrylist;


function getGenre() {
  genreFilter = '&with_genres=' + document.getElementById('genreSelected').value;
  button1.disabled = false;
}

function getPayingOption() {
  payingFilter = '&with_watch_monetization_types=' + document.getElementById('paySelected').value;
  button1.disabled = false;
}

function getCountry() {
  countryFilter = "&watch_region=" + document.getElementById('countrySelected').value;
  if (yearFilter != "" || ratingFilter != "" || genreFilter != "" || payingFilter != "") {
    button1.disabled = false;
  }
}

function getYear() {
  yearf = document.getElementById("yearFilter");
  var year = document.getElementById("yearValue");
  year.innerHTML = yearf.value;
  yearf.oninput = function() {
    year.innerHTML = this.value;
  }
  yearFilter = "&year=" + yearf.value
  button1.disabled = false;
}

function getRating() {
  ratingOption = document.getElementById("rateFilter");
  var rate = ratingOption.value
  if (rate == 0) {
    ratingFilter = "&vote_average.gte=0&vote_average.lte=0.9&with_original_language=en";
  } else if (rate == 1) {
    ratingFilter = "&vote_average.gte=1&vote_average.lte=1.9&with_original_language=en";
  } else if (rate == 2) {
    ratingFilter = "&vote_average.gte=2&vote_average.lte=2.9&with_original_language=en";
  } else if (rate == 3) {
    ratingFilter = "&vote_average.gte=3&vote_average.lte=3.9&with_original_language=en";
  } else if (rate == 4) {
    ratingFilter = "&vote_average.gte=4&vote_average.lte=4.9&with_original_language=en";
  } else if (rate == 5) {
    ratingFilter = "&vote_average.gte=5&vote_average.lte=5.9&with_original_language=en";
  } else if (rate == 6) {
    ratingFilter = "&vote_average.gte=6&vote_average.lte=6.9&with_original_language=en";
  } else if (rate == 7) {
    ratingFilter = "&vote_average.gte=7&vote_average.lte=7.9&with_original_language=en";
  } else if (rate == 8) {
    ratingFilter = "&vote_average.gte=8&vote_average.lte=8.9&with_original_language=en";
  } else if (rate == 9) {
    ratingFilter = "&vote_average.gte=9&vote_average.lte=9.9&with_original_language=en";
  } else if (rate == 10) {
    ratingFilter = "&vote_average.gte=10&with_original_language=en";
  }
  button1.disabled = false;
}

function getMovies(url) {
  let listOfMovies = [];
  let itemsOfMovies = "";
  fetch(url).then(res => res.json()).then(data => {
    listOfMovies = data.results;

    if (listOfMovies.length == 0) {
      console.log("no movie results");
    }

    for (const x of listOfMovies) {

      itemsOfMovies += cardItem(x.title, x.overview, IMG_URL + x.poster_path, x.id);
    }
    document.getElementById("results").innerHTML = itemsOfMovies;
  })
}




function cardItem(y, a, b, id) {

  var x = '<div class="card" style="width: 18rem;">';
  x += '<img src=' + b + ' class="card-img-top" alt="...">';
  x += '<div class="card-body d-flex flex-column">';
  x += '<h6 class="card-title">' + y + '</h6>'
  x += '<p class="card-text">' + a + '</p>';
  x += '<button type="button" class="mt-auto btn btn-outline-primary btn-sm" id=' + id + ' value=' + id + ' onClick="getID(' + id + ')"';
  x += '>More Details!</button></div></div>';
  return x;
}


function getID(id) {
  movieID = document.getElementById(id);
  if (movieID != "") {
    console.log(movieID.value);
  }
}

const resetbtn = document.getElementById("resetBtn");
resetbtn.hidden=true;

function enableSearch() {
  if (countryFilter != "") {
    getMovies(base_URL + yearFilter + ratingFilter + genreFilter + "&watch_region=US" + countryFilter + payingFilter);
    button1.disabled = true;
    genreFilter = "";
    payingFilter = "";
    countryFilter = "";
    yearFilter = "";
    ratingFilter = "";
    resetbtn.hidden=false;
  } else {
    getMovies(base_URL + yearFilter + ratingFilter + genreFilter + "&watch_region=US" + payingFilter);
    button1.disabled = true;
    genreFilter = "";
    payingFilter = "";
    countryFilter = "";
    yearFilter = "";
    ratingFilter = "";
    resetbtn.hidden=false;
  }

}
</script>
{% endblock %}


